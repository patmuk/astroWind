---
import { languages, defaultLang } from '~/utils/i18n/translations';

const supportedLanguages = Object.keys(languages);

function getPreferredLanguage() {
  if (typeof navigator === 'undefined') {
    // We're in SSG mode
    return defaultLang;
  }

  const languageCodes = navigator.languages || [navigator.language];
  for (const code of languageCodes) {
    const language = code.toLowerCase().split(/[_-]+/)[0];
    if (supportedLanguages.includes(language)) {
      return language;
    }
  }
  return defaultLang;
}

const preferredLanguage = getPreferredLanguage();
---

<!-- redirects to the user's preferred language in SSR mode -->
<meta http-equiv="refresh" content={`0;url=/${preferredLanguage}`} />
